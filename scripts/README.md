# Snapshot Analysis Scripts

This directory contains Python scripts for analyzing binary snapshots (`.snap` files) generated by the **LocalApp** tick-frame substrate implementation.

## Binary Snapshot Format

### `tickspace_snapshot.py` - Binary Snapshot Reader

Python library for reading compact binary snapshots (`.snap` files) created by the Java simulation.

**Features:**
- No external dependencies (Python 3.7+ standard library only)
- Auto-detects GZIP compression
- Compact format (~30MB for 3M entities)
- Fast read performance (~1-2 seconds for 3M entities)

**Quick Start:**
```python
from tickspace_snapshot import read_snapshot

# Read a snapshot file
snapshot = read_snapshot('simulation_tick_5000.snap')

print(f"Tick: {snapshot.tick_count:,}")
print(f"Dimensions: {snapshot.dimension_count}D")
print(f"Entities: {snapshot.entity_count:,}")

# Access entity data
for entity in snapshot.entities[:5]:
    print(f"Position: {entity.position}, Energy: {entity.energy}")
```

**Command-Line Usage:**
```bash
python tickspace_snapshot.py simulation_tick_5000.snap
```

**Data Model:**
- `Snapshot` dataclass: `tick_count`, `dimension_count`, `entities`, `entity_count`
- `Entity` dataclass: `position`, `energy`, `generation`, `momentum_cost`, `momentum_vector`, `birth_tick`

**Format Specification:**
See `tick-space-runner/src/main/java/eu/jerrysamek/tickspace/model/exportimport/README.md` for complete binary format details.

## Available Analysis Scripts

All scripts work with binary `.snap` files created by the SnapshotManager.

### 1. `snapshot-stats.py`

Computes shell-wise statistical summaries of entity distributions using Manhattan distance.

**Usage:**
```bash
python snapshot-stats.py <snapshot.snap> [max_entities]
```

**Output:**
- Entities grouped by Manhattan radius shells (r = |x| + |y| + |z|)
- Per-shell statistics:
  - Entity count
  - Average, min, max energy
  - Average generation depth
  - Number of unique momentum vectors

**Example:**
```bash
python snapshot-stats.py simulation_tick_5000.snap
python snapshot-stats.py simulation_tick_5000.snap 100000  # Limit to first 100k entities
```

### 2. `snapshot-visualization.py`

Creates 3D scatter plot visualizations of entity positions colored by energy level.

**Usage:**
```bash
python snapshot-visualization.py <snapshot.snap>
```

**Output:**
- Interactive 3D matplotlib visualization
- X, Y, Z axes showing spatial distribution
- Color map (plasma) indicates energy levels
- Point size: 1px for clear resolution

**Dependencies:**
- `matplotlib`
- `mpl_toolkits.mplot3d`

**Example:**
```bash
python snapshot-visualization.py simulation_tick_10000.snap
```

### 3. `snapshot-energy-histogram.py`

Generates two analytical plots: energy distribution histogram and radial density profile.

**Usage:**
```bash
python snapshot-energy-histogram.py <snapshot.snap>
```

**Output:**
Two matplotlib figures:

1. **Energy Distribution Histogram**
   - 25 bins spanning full energy range
   - Shows frequency distribution of entity energies

2. **Radial Density Profile**
   - Euclidean distance from origin (r = √(x² + y² + z²))
   - Entities per radial shell
   - Shows spatial concentration patterns

**Dependencies:**
- `numpy`
- `matplotlib`

**Example:**
```bash
python snapshot-energy-histogram.py simulation_tick_15000.snap
```

### 4. `snapshot-csv-stats.py`

Computes comprehensive statistics and exports to JSON and CSV formats.

**Usage:**
```bash
python snapshot-csv-stats.py <snapshot.snap>
```

**Output:**
- `stats.json` - Full statistics in JSON format
- `stats.csv` - CSV format for spreadsheet analysis
- Metrics include: generation stats, energy distribution, momentum analysis, bounding boxes, radial density

**Example:**
```bash
python snapshot-csv-stats.py simulation_tick_5000.snap
```

### 5. `snapshot-observer.py`

Simulates observer's field of view and creates 2D projection visualization.

**Usage:**
```bash
python snapshot-observer.py <snapshot.snap>
```

**Output:**
- 2D heatmap showing entity density from observer's perspective
- Configurable observer position and field-of-view radius (edit script to adjust)

**Example:**
```bash
python snapshot-observer.py simulation_tick_10000.snap
```

### 6. `snapshot-center-of-mass.py`

Computes center of mass and radial momentum flux metrics.

**Usage:**
```bash
python snapshot-center-of-mass.py <snapshot.snap>
```

**Output:**
- `<filename>_metrics.csv` - Center of mass coordinates and radial flux
- Useful for tracking system drift and expansion

**Example:**
```bash
python snapshot-center-of-mass.py simulation_tick_5000.snap
```

## Binary Snapshot Usage Examples

### Analyzing Multiple Snapshots

```python
import glob
from tickspace_snapshot import read_snapshot

# Load all snapshots
snapshots = []
for filepath in sorted(glob.glob('simulation_tick_*.snap')):
    snapshot = read_snapshot(filepath)
    snapshots.append(snapshot)

# Track entity count over time
for snap in snapshots:
    print(f"Tick {snap.tick_count:6d}: {snap.entity_count:8,} entities")

# Calculate growth rate
if len(snapshots) >= 2:
    first = snapshots[0]
    last = snapshots[-1]
    ticks = last.tick_count - first.tick_count
    entity_growth = last.entity_count - first.entity_count
    growth_rate = entity_growth / ticks if ticks > 0 else 0
    print(f"Average growth: {growth_rate:.2f} entities/tick")
```

### Energy Analysis

```python
from tickspace_snapshot import read_snapshot

snapshot = read_snapshot('simulation_tick_10000.snap')

# Calculate total energy
total_energy = sum(e.energy for e in snapshot.entities)
print(f"Total energy: {total_energy:,}")

# Energy distribution by generation
from collections import defaultdict
energy_by_gen = defaultdict(list)
for entity in snapshot.entities:
    energy_by_gen[entity.generation].append(entity.energy)

for gen in sorted(energy_by_gen.keys()):
    energies = energy_by_gen[gen]
    avg = sum(energies) / len(energies)
    print(f"Gen {gen}: {len(energies):,} entities, avg energy: {avg:.2f}")
```

### Spatial Analysis

```python
from tickspace_snapshot import read_snapshot
import statistics

snapshot = read_snapshot('simulation_tick_10000.snap')

# Calculate center of mass
x_coords = [e.position[0] for e in snapshot.entities]
y_coords = [e.position[1] for e in snapshot.entities]
z_coords = [e.position[2] for e in snapshot.entities]

center = [
    statistics.mean(x_coords),
    statistics.mean(y_coords),
    statistics.mean(z_coords)
]
print(f"Center of mass: {center}")

# Spatial spread
spread = [
    max(x_coords) - min(x_coords),
    max(y_coords) - min(y_coords),
    max(z_coords) - min(z_coords)
]
print(f"Spatial spread: {spread}")
```

### Momentum Distribution

```python
from tickspace_snapshot import read_snapshot
import collections

snapshot = read_snapshot('simulation_tick_10000.snap')

# Momentum cost distribution
momentum_costs = collections.Counter(e.momentum_cost for e in snapshot.entities)
print(f"Top 5 momentum costs: {momentum_costs.most_common(5)}")

# Count stationary vs moving entities
stationary = sum(1 for e in snapshot.entities if all(v == 0 for v in e.momentum_vector))
moving = len(snapshot.entities) - stationary
print(f"Stationary: {stationary:,}, Moving: {moving:,}")
```

## Installation

**Binary Snapshot Reader:**
- No dependencies required (Python 3.7+ standard library only)

**Analysis Scripts:**
```bash
pip install numpy matplotlib
```

## Typical Workflow

1. **Run the substrate simulation:**
   ```bash
   # From project root
   mvn exec:java -pl tick-space-runner -Dexec.mainClass="eu.jerrysamek.tickspace.runner.LocalApp"
   ```

2. **Snapshots are generated** during simulation using the SnapshotManager

3. **Analyze snapshots:**
   ```bash
   # Quick snapshot info
   python scripts/tickspace_snapshot.py simulation_tick_5000.snap

   # Statistical analysis
   python scripts/snapshot-stats.py simulation_tick_5000.snap

   # 3D visualization
   python scripts/snapshot-visualization.py simulation_tick_5000.snap

   # Energy histograms
   python scripts/snapshot-energy-histogram.py simulation_tick_5000.snap

   # CSV export
   python scripts/snapshot-csv-stats.py simulation_tick_5000.snap
   ```

## Theoretical Context

These scripts support empirical validation of tick-frame physics principles:

- **Collision Persistence Principle** (Doc 30) - Entity lifetime and density patterns
- **Imbalance Theory** (Doc 29) - Energy distribution asymmetries
- **Horizon Boundaries** (Doc 26) - Radial expansion and observable limits
- **Temporal Surfing** (Doc 28) - Persistence patterns across ticks

See `docs/theory/` for full theoretical framework.

## Notes

- Snapshot files can be large (millions of entities); `snapshot-stats.py` supports limiting processing via `max_entities` parameter
- All scripts use the binary snapshot reader for fast, memory-efficient loading
- Color schemes optimized for visualization clarity (plasma, custom palettes)
- Scripts are single-snapshot focused; time-series analysis can be built by iterating over multiple snapshots

## Future Enhancements

Potential extensions:
- Time-series animation across multiple snapshots
- Collision event tracking between consecutive snapshots
- Momentum vector field visualization
- Entity lineage tracking (parent-child relationships)
- Comparative analysis between different simulation parameters